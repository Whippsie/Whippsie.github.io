<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="styles/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="scripts/files.js"></script>
<script src="scripts/objects.js"></script>
<script src="scripts/parsing.js"></script>
<script>
//TODO: Modify this into https://www.w3schools.com/tags/tag_fieldset.asp for better graphics
function getAllIndexes(arr, val) {
    var indexes = [], i;
    for(i = 0; i < arr.length; i++)
        if (arr[i] === val)
            indexes.push(i);
    return indexes;
}
function rosToJava(){
	var args = rosToDict();
	var javatext = dictToJava(args);
	//var attributes = preparedataDict(javatext);
	//updateUI(attributes);
}
function readFile (fullpath){
	$.ajax({
		url: fullpath,
		dataType: "text",
		success: function (data) {
			return data;
	}  
}

function compareConfig(){
var dictDemo = prepDemoDict();
var dictUser = prepConfigDict();
compareDict(dictDemo, dictUser);
}

function compareDict(dictDemo, dictUser){
	for (var keyDemo in dictDemo){
		var valueDemo = dictDemo[keyDemo];
		for (var keyUser in dictUser){
			var valueUser = dictUser[keyUser];
			if (valueUser == valueDemo){
				delete dictDemo[keyDemo];
				delete dictUser[keyUser];
			}
		}
	}
	
	//Those still in demo are missing from config
	for (var keyDemo in dictDemo){
		changeColorRadio(keyDemo,dictDemo[keyDemo],'missing');
	}
	//Those still in config are extra to demo
	for (var keyUser in dictUser){
		changeColorRadio(keyUser,dictUser[dictUser],'incorrect');
	}
}

//typeError is either incorrect (extra) or missing 
function changeColorRadio(radioName, value, typeError){
	$('input:radio[name='+radioName+']').each(function() {
		if (jQuery(this).attr('value') == value){
			jQuery(this).addClass(typeError);
		}
	});
}
function prepDemoDict(){
	var selected = $('#demo_files').val();
	var dataDemo = readFile("demos/"+selected+".launch");
	var dictDemo = rosToDict(data);
	return dictDemo;
}

function prepConfigDict(){
	parsetoROS ('ConfigUser');
	var dataUser = readFile("ConfigUser.launch");
	var dictUser = rosToDict(dataUser);
	return dictUser;
}
$(document).ready(function(){
	//$('#mods').change(function(){
		//var selected = jQuery(this).val();
		//TODO: Remove next line eventually
		//if (selected == "Camera"){
		/*
			var exist = false;
			$('input:radio').each(function() {
				if (jQuery(this).attr('class') == selected){
					exist = true;
				};
			});
			*/
			//if (exist){
			//TODO: Remove hardcoded radio, change the name
				//var x = document.querySelectorAll(".radio");
				//for (var i = 0; i < x.length; i++) {
					//x[i].show();
					//x[i].style.display = "block";
				//}
			//}else{
			//TODO: Vérifier si un des radio existe, si oui, juste switch la vue de none à inline
				$.ajax({
					url: "flags.txt",
					dataType: "text",
					success: function (data) {
							//alert('prep new data');
							var args = preparedata(data);
							addRadioBool(args);
							
					}   	
				});
			
		//}else{
		//var allParas = document.getElementsByTagName('input');
			//var x = document.querySelectorAll(".radio");
			//for (var i = 0; i < x.length; i++) {
				//x[i].style.display = "none";
				//x[i].hide();
			//}
		//}
		//});
	//$('#mods').trigger("change");
});
</script>
</head>
<body>
<h1 id="title"> Prototype - Configuration Duckietown </h1>
<div id="space">
</div>


<div id="div_buttons">
	<div class="btn">
		<button id="btn_ros2java" onclick="rosToJava()">Get config off ROS Launch file</button>
		<a download="" id="downloadlinkjava" style="display: none">Download Java</a>
	</div>
	<div class="btn">
		<button id="btn_java2ros" onclick="parsetoROS('Test')">Generate ROS Launch file from config</button>
		<a download="" id="downloadlinkros" style="display: none">Download ROS</a>
	</div>
</div>
<!-- change the drop down list to static, checks the files in the folder -->
<select id="demo_files">
  <option value="indefinite_navigation">indefinite_navigation</option>
  <option value="intersection">intersection</option>
  <option value="joystick">joystick</option>
  <option value="lane_following">lane_following</option>
  <option value="localization">localization</option>
  <option value="localization_frontend">localization_frontend</option>
  <option value="localization_navigation">localization_navigation</option>
</select>
<button id="btn_demos" onclick="compareConfig()">Compare config</button>
</body>
</html>
